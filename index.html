<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>true-shuffle — True Shuffle für jede Playlist</title>
  <meta name="description" content="Echter Shuffle für jede Playlist: jeder Song genau einmal pro Durchlauf – keine Wiederholungen, keine ausgelassenen Tracks. Jetzt für den Beta-Test anmelden." />
  <meta name="theme-color" content="#24252a" />
  <meta property="og:title" content="true-shuffle — der echte Shuffle für jede Playlist" />
  <meta property="og:description" content="Echter Shuffle: jeder Song genau einmal – ohne Wiederholungen, ohne ausgelassene Tracks." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://mikamcflurry.github.io/true-shuffle-site/assets/og_true_shuffle_1200x630.png" />
  <meta property="og:url" content="https://mikamcflurry.github.io/true-shuffle-site/index.html" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:image" content="https://mikamcflurry.github.io/true-shuffle-site/assets/og_true_shuffle_1200x630.png" />
  <link rel="canonical" href="https://mikamcflurry.github.io/true-shuffle-site/index.html" />
  <meta name="twitter:card" content="summary_large_image" />
  <link rel="icon" type="image/png" href="assets/favicon.png" />
  <link rel="alternate" hreflang="de" href="index.html" />
  <link rel="alternate" hreflang="en" href="en.html" />
  <style>
    :root{
      --bg:#24252a; --bg2:#17181c;
      --panel: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --muted2: rgba(255,255,255,.56);
      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --radius: 18px;
      --radius2: 26px;
      --max: 1120px;
      --ring: 0 0 0 6px rgba(255,255,255,.10);
      --btnh: 44px;
    }
    body.light{
      --bg:#f7f7f7; --bg2:#ffffff;
      --panel: rgba(0,0,0,.05);
      --stroke: rgba(0,0,0,.12);
      --text: rgba(0,0,0,.90);
      --muted: rgba(0,0,0,.70);
      --muted2: rgba(0,0,0,.55);
      --shadow: 0 18px 55px rgba(0,0,0,.14);
      --ring: 0 0 0 6px rgba(0,0,0,.10);
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background:
        radial-gradient(900px 380px at 18% -5%, rgba(255,255,255,.06), transparent 65%),
        radial-gradient(900px 380px at 85% 10%, rgba(255,255,255,.04), transparent 60%),
        radial-gradient(700px 300px at 60% 85%, rgba(255,255,255,.03), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      overflow-x:hidden;
    }
    body.light{
      background:
        radial-gradient(900px 380px at 18% -5%, rgba(0,0,0,.06), transparent 65%),
        radial-gradient(900px 380px at 85% 10%, rgba(0,0,0,.04), transparent 60%),
        radial-gradient(700px 300px at 60% 85%, rgba(0,0,0,.03), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
    }
    a{ color:inherit; text-decoration:none; }
    button,input,textarea,select{ font:inherit; }
    img{ max-width:100%; height:auto; }
    .wrap{ width:100%; display:flex; justify-content:center; }
    .container{ width:min(var(--max), calc(100% - 40px)); margin:0 auto; }

    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(36,37,42,.88), rgba(36,37,42,.62));
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    body.light header{
      background: linear-gradient(to bottom, rgba(247,247,247,.94), rgba(247,247,247,.72));
      border-bottom: 1px solid rgba(0,0,0,.08);
    }
    .nav{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 0; gap:12px; flex-wrap:wrap;
    }
    .brand{ display:flex; align-items:center; gap:12px; min-width:0; flex:1 1 auto; }
    .brand img{
      width:40px; height:40px; border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      flex:0 0 auto;
    }
    body.light .brand img{ border-color: rgba(0,0,0,.10); background: rgba(0,0,0,.03); }
    .brand strong{ display:block; font-weight:900; white-space:nowrap; line-height:1.1; }
    .brand span{ display:block; font-size:12px; color:var(--muted2); margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:52vw; }

    .navlinks{ display:flex; align-items:center; gap:10px; color:var(--muted); font-size:14px; }
    .navlinks a{ padding:8px 10px; border-radius:12px; }
    .navlinks a:hover{ background: rgba(255,255,255,.06); color: var(--text); }
    body.light .navlinks a:hover{ background: rgba(0,0,0,.05); }

    .navcta{ display:flex; align-items:center; gap:10px; flex:1 1 100%; justify-content:flex-start; flex-wrap:wrap; }

    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      height: var(--btnh); padding:0 14px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--text);
      cursor:pointer; user-select:none; white-space:nowrap;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    body.light .btn{ border-color: rgba(0,0,0,.12); background: rgba(0,0,0,.04); }
    .btn:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.18); transform: translateY(-1px); }
    body.light .btn:hover{ background: rgba(0,0,0,.07); border-color: rgba(0,0,0,.14); }
    .btn:active{ transform: translateY(0); }
    .btn-primary{
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.78));
      color: #24252a;
      border-color: rgba(255,255,255,.25);
      box-shadow: 0 10px 30px rgba(255,255,255,.08);
      font-weight: 900;
    }

    .menu-btn{ display:none; }
    .drawer{ display:none; padding:10px 0 16px; width:100%; }
    .drawer.open{ display:block; }
    .drawer a{
      display:block; padding:12px 12px; border-radius:14px; margin-top:10px;
      color: var(--muted);
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    body.light .drawer a{ border-color: rgba(0,0,0,.10); background: rgba(0,0,0,.02); }

    @media (max-width: 980px){
      .navlinks{ display:none; }
      .menu-btn{ display:inline-flex; }
    }
    @media (max-width: 520px){
      .container{ width: calc(100% - 28px); }
      .brand span{ display:none; }
    }

    main{ padding:34px 0 70px; }

    .pill{
      display:inline-flex; align-items:center; gap:10px;
      padding:8px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-size:13px;
    }
    body.light .pill{ border-color: rgba(0,0,0,.12); background: rgba(0,0,0,.03); }
    .dot{ width:8px; height:8px; border-radius:999px; background: rgba(255,255,255,.92); box-shadow: 0 0 0 4px rgba(255,255,255,.10); }
    body.light .dot{ box-shadow: 0 0 0 4px rgba(0,0,0,.10); }

    .hero{ display:grid; grid-template-columns: 1.1fr .9fr; gap:18px; align-items:start; margin-top:18px; }
    @media (max-width: 980px){ .hero{ grid-template-columns: 1fr; } }

    h1{ font-size: clamp(30px, 3.4vw, 52px); line-height:1.06; margin:14px 0 10px; letter-spacing:-0.02em; }
    .lead{ color: var(--muted); font-size:16.5px; line-height:1.65; margin:0 0 14px; max-width:68ch; }
    .subnote{ color: var(--muted2); font-size:13px; line-height:1.55; margin-top:10px; }
    .hero-actions{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-top:10px; }

    .panel{
      border-radius: var(--radius2);
      border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      box-shadow: var(--shadow);
      padding:16px;
      overflow:hidden;
    }
    body.light .panel{ border-color: rgba(0,0,0,.12); background: #ffffff; }

    .hero-media{
      display:block;
      width:100%;
      max-height: 380px;
      object-fit: contain;
      margin: 6px auto 14px;
      border-radius: 22px;
      border: none;
      background: transparent;
      box-shadow: 0 16px 50px rgba(0,0,0,.25);
    }
    body.light .hero-media{
      box-shadow: 0 14px 38px rgba(0,0,0,.12);
    }
@media (max-width: 520px){
      .hero-media{ max-height: 320px; }
    }

.mock{
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.28);
      padding:14px;
    }
    body.light .mock{ border-color: rgba(0,0,0,.12); background: rgba(0,0,0,.03); }

    .mock-row{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:10px; border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      margin-bottom:10px;
    }
    body.light .mock-row{ border-color: rgba(0,0,0,.10); background: rgba(0,0,0,.03); }
    .mock-row:last-child{ margin-bottom:0; }
    .mock-title{ display:flex; align-items:center; gap:10px; font-weight:900; }
    .mini{
      width:28px; height:28px; border-radius:10px;
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-weight:900;
      flex:0 0 auto;
    }
    body.light .mini{ border-color: rgba(0,0,0,.14); background: rgba(0,0,0,.04); }
    .mock-meta{ color: var(--muted2); font-size:13px; text-align:right; }
    .two-col{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:12px; }
    @media (max-width:520px){ .two-col{ grid-template-columns: 1fr; } }

    .badges{ display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
    .badge{
      padding: 7px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size: 13px;
    }
    body.light .badge{ border-color: rgba(0,0,0,.12); background: rgba(0,0,0,.03); }

    section{ padding: 52px 0; }
    .section-title{ display:flex; align-items:flex-end; justify-content:space-between; gap:12px; margin-bottom: 16px; flex-wrap:wrap; }
    .section-title h2{ margin:0; font-size:24px; letter-spacing:-0.01em; }
    .section-title p{ margin:0; color: var(--muted); max-width: 76ch; line-height:1.55; }

    /* Slider: desktop-friendly (portrait images) */
    .slider{
      position: relative;
      max-width: 980px;
      margin: 0 auto;
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      overflow:hidden;
      box-shadow: var(--shadow);
    }
    body.light .slider{ border-color: rgba(0,0,0,.12); background: #ffffff; }
    .slider-track{ display:flex; transition: transform .35s ease; will-change: transform; align-items: center; }
    .slide{ min-width:100%; padding:14px; display:flex; justify-content:center; align-items:center; }
    .slide-media{
      width: 100%;
      height: clamp(320px, 55vh, 560px);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      position: relative;
      overflow: hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    body.light .slide-media{
      border-color: rgba(0,0,0,.12);
      background: #ffffff;
    }
    .slide-media::before{
      content:"";
      position:absolute;
      inset:-45px;
      background-image: var(--bg);
      background-size: cover;
      background-position: center;
      filter: blur(26px);
      transform: scale(1.15);
      opacity: .35;
    }
    body.light .slide-media::before{ opacity: .20; }
    .slide-media::after{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(80% 60% at 50% 50%, rgba(0,0,0,.40), transparent 70%);
      opacity:.45;
      pointer-events:none;
    }
    body.light .slide-media::after{
      background: radial-gradient(80% 60% at 50% 50%, rgba(255,255,255,.65), transparent 70%);
      opacity:.65;
    }
    .slide-media img{
      position: relative;
      max-width: 92%;
      max-height: 92%;
      width: auto;
      height: auto;
      object-fit: contain;
      border-radius: 14px;
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
      background: transparent;
    }
    @media (max-width: 520px){
      .slide-media{ height: min(54vh, 420px); }
      .slide-media img{ max-width: 94%; max-height: 94%; }
    }
    @media (min-width: 980px){
      .slide img{ height: 520px; max-width: 980px; }
    }
    body.light .slide img{ border-color: rgba(0,0,0,.12); background: rgba(0,0,0,.03); }
    .slider-nav{ position:absolute; inset:0; pointer-events:none; }
    .slider-btn{
      pointer-events:auto;
      position:absolute; top:50%; transform: translateY(-50%);
      height:40px; padding:0 12px;
      border-radius:999px;
      opacity:.95;
    }
    .slider-btn.prev{ left: 12px; }
    .slider-btn.next{ right: 12px; }
    .slider-dots{ display:flex; gap:8px; justify-content:center; padding: 12px 0 0; }
    .slider-dot{
      width:9px; height:9px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      cursor:pointer;
    }
    body.light .slider-dot{ border-color: rgba(0,0,0,.18); background: rgba(0,0,0,.08); }
    .slider-dot.active{ background: rgba(255,255,255,.55); border-color: rgba(255,255,255,.55); }
    body.light .slider-dot.active{ background: rgba(0,0,0,.35); border-color: rgba(0,0,0,.35); }

    /* Forms */
    .cta{
      border-radius: 34px;
      border: 1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(700px 250px at 20% 0%, rgba(255,255,255,.10), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
      padding: 20px;
      box-shadow: var(--shadow);
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:14px;
      align-items:center;
    }
    body.light .cta{
      border-color: rgba(0,0,0,.12);
      background:
        radial-gradient(700px 250px at 20% 0%, rgba(0,0,0,.06), transparent 55%),
        linear-gradient(180deg, rgba(0,0,0,.03), rgba(0,0,0,.02));
    }
    @media (max-width:980px){ .cta{ grid-template-columns: 1fr; } }
    .form{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; align-items:flex-start; }
    .input{
      flex:1 1 220px; min-width:0;
      padding:11px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.24);
      color: var(--text);
      outline:none;
    }
    body.light .input{ border-color: rgba(0,0,0,.12); background: rgba(0,0,0,.03); }
    .input:focus{ border-color: rgba(255,255,255,.26); box-shadow: var(--ring); }
    .consent{
      width:100%;
      display:flex; gap:10px; align-items:flex-start; justify-content:flex-end;
      color: var(--muted2); font-size:13px; line-height:1.45;
    }
    .consent input{ margin-top:3px; }

    /* Reviews */
    .reviews-grid{ display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
    @media (max-width:980px){ .reviews-grid{ grid-template-columns:1fr; } }
    .review{
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      padding:14px;
    }
    body.light .review{ border-color: rgba(0,0,0,.12); background: rgba(0,0,0,.03); }
    .review .name{ font-weight: 900; }
    .review .stars{ letter-spacing:.06em; opacity:.92; }
    .review .text{ color: var(--muted); margin-top: 8px; line-height:1.55; }
    .review .meta{ color: var(--muted2); font-size: 12px; margin-top: 8px; }

    /* FAQ chevron */
    details{
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      padding:14px;
    }
    body.light details{ border-color: rgba(0,0,0,.12); background: rgba(0,0,0,.03); }
    details + details{ margin-top: 10px; }
    summary{
      cursor:pointer;
      list-style:none;
      font-weight:900;
      display:flex; align-items:center; justify-content:space-between; gap:14px;
    }
    summary::-webkit-details-marker{ display:none; }
    .chev{
      width:28px; height:28px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      display:grid; place-items:center;
      position: relative;
      flex:0 0 auto;
    }
    body.light .chev{ border-color: rgba(0,0,0,.12); background: rgba(0,0,0,.03); }
    .chev::before{
      content:"";
      width: 8px; height: 8px;
      border-right: 2px solid var(--muted);
      border-bottom: 2px solid var(--muted);
      transform: rotate(45deg);
      display:block;
      margin-top: -2px;
    }
    details[open] .chev::before{ transform: rotate(-135deg); margin-top: 2px; }
    details p{ margin:10px 0 0; color: var(--muted); line-height:1.6; }

    footer{
      border-top: 1px solid rgba(255,255,255,.10);
      padding: 26px 0 40px;
      color: var(--muted2);
      font-size: 13px;
    }
    body.light footer{ border-top: 1px solid rgba(0,0,0,.10); }
    .foot{ display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    .foot a{ color: var(--muted); padding:8px 10px; border-radius:12px; }
    .foot a:hover{ background: rgba(255,255,255,.06); color: var(--text); }
    body.light .foot a:hover{ background: rgba(0,0,0,.05); }

    .modal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.72); z-index:200; padding:16px; }
    .modal-panel{
      max-width: 920px; margin:60px auto;
      border-radius:24px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(10,10,10,.92);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex; flex-direction:column;
      max-height: 85vh;
    }
    body.light .modal-panel{ background: rgba(247,247,247,.96); border-color: rgba(0,0,0,.12); }
    .modal-header{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.10); }
    body.light .modal-header{ border-bottom:1px solid rgba(0,0,0,.10); }
    .modal-content{ padding:16px; color: var(--muted); line-height:1.65; overflow:auto; -webkit-overflow-scrolling:touch; }

    #cookieBanner{
      position:fixed; left:16px; right:16px; bottom:16px;
      z-index:210;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(10,10,10,.86);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      padding:14px;
      display:none;
    }
    body.light #cookieBanner{ border-color: rgba(0,0,0,.12); background: rgba(247,247,247,.92); }
    .cookie-row{ display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .cookie-text{ color: var(--muted); font-size:13px; line-height:1.45; flex:1 1 320px; }
    .cookie-actions{ display:flex; gap:10px; flex:0 0 auto; }
  
    /* --- UI polish patch (header + slider arrows + mock meta) --- */
    header{
      backdrop-filter: blur(14px);
      box-shadow: 0 10px 30px rgba(0,0,0,.10);
    }
    body.light header{
      background: rgba(255,255,255,.78) !important;
    }

    .mock-meta{ white-space: nowrap; }
    .mock-meta .unit{ opacity:.75; }
    @media (max-width: 420px){
      .mock-meta{ white-space: normal; }
      .mock-meta .unit{ display:block; }
    }

    /* Slider arrows: consistent in dark/light */
    .slider-btn{
      width:44px; height:44px;
      padding:0 !important;
      border-radius:12px !important;
      display:flex; align-items:center; justify-content:center;
      border:1px solid rgba(120,120,120,.25) !important;
      background: rgba(255,255,255,.72) !important;
      box-shadow: 0 6px 18px rgba(0,0,0,.08);
      font-size:0 !important; /* hide text arrows */
      line-height:0 !important;
    }
    body:not(.light) .slider-btn{
      border:1px solid rgba(255,255,255,.14) !important;
      background: rgba(10,10,10,.55) !important;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .slider-btn svg{ width:18px; height:18px; }
    body.light .slider-btn svg path{ fill:#111; }
    body:not(.light) .slider-btn svg path{ fill:#fff; }
    
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="container">
      <div class="nav">
        <a class="brand" href="#top">
          <img id="brandLogo" src="assets/logo_dark.png" alt="true-shuffle logo" />
          <div>
            <strong>true-shuffle</strong>
            <span>Echtes Shuffle für jede Playlist</span>
          </div>
        </a>

        <nav class="navlinks" aria-label="Navigation">
          <a href="#impressions">Impressionen</a>
          <a href="#beta">Beta</a>
          <a href="#reviews">Bewertungen</a>
            <a href="#contact">Kontakt</a>
          <a href="#faq">FAQ</a>
        </nav>

        <div class="navcta">
          <button class="btn" id="themeToggle" type="button">
            <span id="themeIcon" aria-hidden="true">☾</span>
            <span id="themeLabel">Light</span>
          </button>
          <a class="btn" href="en.html" aria-label="Language switch">EN</a>
          <button class="btn menu-btn" id="menuBtn" aria-expanded="false" aria-controls="drawer">
            Menü <span aria-hidden="true">≡</span>
          </button>
          <a class="btn btn-primary" href="#beta">Zum Beta-Test</a>
        </div>

        <div class="drawer" id="drawer">
          <a href="#impressions">Impressionen</a>
          <a href="#beta">Beta</a>
          <a href="#reviews">Bewertungen</a>
          <a href="#faq">FAQ</a>
        </div>
      </div>
    </div>
  </div>
</header>

<main id="top">
  <div class="wrap">
    <div class="container">
      <div class="pill">
        <span class="dot" aria-hidden="true"></span>
        <span><b>Problem:</b> Viele Streaming-„Shuffle“ spielen nur einen Teil deiner Playlist – und oft wiederholt sich die Reihenfolge.</span>
      </div>

      <div class="hero">
        <div>
          <h1>Echter Shuffle für jede Playlist.<br/>Jeder Song – ohne nervige Wiederholung.</h1>
          <p class="lead">true-shuffle sorgt dafür, dass deine Playlist wirklich komplett läuft: <b>kein Song wird ausgelassen</b> und <b>keiner doppelt gespielt</b> – wie beim klassischen MP3-Player, nur mit deinem Streamingdienst.</p>

          <div class="hero-actions">
            <a class="btn btn-primary" href="#beta">▶ Auf die Warteliste</a>
            <a class="btn" href="#impressions">Impressionen ansehen</a>
          </div>
          <div class="subnote">Kinderleicht: Playlist wählen → Shuffle drücken → genießen.</div>
        </div>

        <aside class="panel" aria-label="Preview">
          <img id="heroMedia" class="hero-media" src="assets/brand_logo_loop.gif" alt="true-shuffle demo loop" />

          <div class="two-col">
            <div class="mock">
              <div class="mock-row">
                <div class="mock-title"><div class="mini">✓</div>Vollständig</div>
                <div class="mock-meta">10–1.000.000+ <span class="unit">Songs</span></div>
              </div>
              <div class="mock-row">
                <div class="mock-title"><div class="mini">∞</div>Keine Repeats</div>
                <div class="mock-meta">Alles wird gespielt</div>
              </div>
              <div class="mock-row">
                <div class="mock-title"><div class="mini">⟲</div>Wirklich zufällig</div>
                <div class="mock-meta">keine Muster</div>
              </div>
            </div>

            <div class="mock">
              <div style="font-weight:900; margin-bottom:8px;">Streaming Dienste</div>
              <div class="badges">
                <span class="badge">Spotify</span>
<span class="badge">Apple Music</span>
<span class="badge">YouTube Music</span>
<span class="badge">Amazon Music</span>
<span class="badge">Deezer</span>
<span class="badge">Tidal</span>
<span class="badge">SoundCloud</span>
<span class="badge">Qobuz</span>
              </div>
              <div class="subnote" style="margin-top:10px;">Du bleibst bei deinem Dienst. true-shuffle kümmert sich um echte Zufallsreihenfolge.</div>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <section id="impressions">
    <div class="wrap">
      <div class="container">
        <div class="section-title">
          <div>
            <h2>Impressionen</h2>
            <p>Werbebilder & App-Impressionen (echte App-Demos folgen). Swipe am Handy, Pfeile am Desktop.</p>
          </div>
        </div>
        <div class="slider" aria-label="Image slider">
          <div class="slider-track" id="sliderTrack"></div>
          <div class="slider-nav">
            <button class="btn slider-btn prev" type="button" id="prevSlide"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M15.5 19 8.5 12l7-7 1.5 1.5L11.5 12l5.5 5.5z"/></svg></button>
            <button class="btn slider-btn next" type="button" id="nextSlide"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8.5 5 15.5 12l-7 7-1.5-1.5L12.5 12 7 6.5z"/></svg></button>
          </div>
        </div>
        <div class="slider-dots" id="sliderDots"></div>
        <div class="subnote" id="sliderNote"></div>
      </div>
    </div>
  </section>

  <section id="beta">
    <div class="wrap">
      <div class="container">
        <div class="cta">
          <div>
            <h2 style="margin:0 0 8px; font-size:24px;">Beta-Test: sichere dir einen Platz</h2>
            <p style="margin:0; color:var(--muted); line-height:1.55;">Melde dich an und wir informieren dich, sobald true-shuffle startklar ist.</p>
            <div class="subnote">Kein Spam. Nur Updates zum Start. Details in <a href="#" onclick="openLegal('privacy');return false;" style="text-decoration:underline;">Datenschutz</a>.</div>
          </div>

          <form class="form" id="betaForm" method="POST" target="beta_iframe" autocomplete="on">
            <input type="hidden" name="action" value="beta" />
            <input type="hidden" name="privacyVersion" value="2026-02-21" />
            <input type="hidden" id="betaRef" name="referrer" value="" />
            <input type="hidden" id="betaLocale" name="locale" value="" />
            <div style="position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden;" aria-hidden="true">
              <label>Website <input type="text" name="website" tabindex="-1" autocomplete="off" /></label>
            </div>
            <input class="input" type="text" id="betaName" name="name" placeholder="Name (optional)" />
            <input class="input" type="email" id="betaEmail" name="email" placeholder="E-Mail" required />

            <select class="input" id="betaService" name="service" required>
              <option value="" disabled selected>Streamingdienst wählen</option>
              <option value="spotify">Spotify</option>
              <option value="apple_music">Apple Music</option>
              <option value="youtube_music">YouTube Music</option>
              <option value="amazon_music">Amazon Music</option>
              <option value="deezer">Deezer</option>
              <option value="tidal">Tidal</option>
              <option value="soundcloud">SoundCloud</option>
              <option value="qobuz">Qobuz</option>
              <option value="other">Andere</option>
            </select>

            <select class="input" id="betaPlaylistSize" name="playlistSize">
              <option value="" selected>Playlistgröße (optional)</option>
              <option value="lt100">&lt; 100 Songs</option>
              <option value="100-500">100–500 Songs</option>
              <option value="500-1000">500–1.000 Songs</option>
              <option value="1000-5000">1.000–5.000 Songs</option>
              <option value="5000-10000">5.000–10.000 Songs</option>
              <option value="10000plus">10.000+ Songs</option>
            </select>

            <input type="hidden" name="source" value="website" />
            <input type="hidden" id="betaUA" name="userAgent" value="" />
            <button class="btn btn-primary" id="betaSubmit" type="submit">Anmelden</button>

            <div class="consent">
              <input type="checkbox" id="betaConsent" name="consent" value="1" required />
              <label for="betaConsent">Ich willige ein, dass meine Angaben zur Warteliste verarbeitet werden. (<a href="#" onclick="openLegal('privacy');return false;" style="text-decoration:underline;">Datenschutz</a>)</label>
            </div>
            <div class="subnote" id="betaMsg" aria-live="polite" style="width:100%; text-align:right;"></div>
          </form>

          <iframe id="beta_iframe" name="beta_iframe" style="display:none;"></iframe>
        </div>
      </div>
    </div>
  </section>

  <section id="reviews">
    <div class="wrap">
      <div class="container">
        <div class="section-title">
          <div>
            <h2>Bewertungen</h2>
            <p>Hier siehst du freigegebene Bewertungen. Neue Bewertungen erscheinen nach kurzer Prüfung.</p>
          </div>
          <div class="pill" id="ratingBadge"><span class="dot"></span><span>⭐ …</span></div>
        </div>

        <div class="subnote" id="reviewsStatus" style="margin-top:0; margin-bottom:12px;"></div>
        <div class="reviews-grid" id="reviewsList"></div>

        <div class="panel" style="margin-top:14px;">
          <h3 style="margin:0 0 10px;">Bewertung schreiben</h3>

          <form class="form" id="reviewForm" method="POST" target="review_iframe">
            <input type="hidden" name="action" value="review" />
            <input type="hidden" name="privacyVersion" value="2026-02-21" />
            <div style="position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden;" aria-hidden="true">
              <label>Website <input type="text" name="website" tabindex="-1" autocomplete="off" /></label>
            </div>
            <input class="input" type="text" id="reviewName" name="name" placeholder="Name (optional)" />
            <select class="input" id="reviewRating" name="rating" style="flex:0 0 180px;">
              <option value="5">★★★★★ (5)</option>
              <option value="4">★★★★☆ (4)</option>
              <option value="3">★★★☆☆ (3)</option>
              <option value="2">★★☆☆☆ (2)</option>
              <option value="1">★☆☆☆☆ (1)</option>
            </select>
            <textarea class="input" id="reviewText" name="text" placeholder="Deine Bewertung…" maxlength="400" style="flex:1 1 100%; min-height:92px;"></textarea>
            <input type="hidden" name="source" value="website" />
            <input type="hidden" id="reviewUA" name="userAgent" value="" />
            <button class="btn btn-primary" id="reviewSubmit" type="submit">Bewertung senden</button>
            <div class="consent">
              <input type="checkbox" id="reviewConsent" name="consent" value="1" required />
              <label for="reviewConsent">Ich willige ein, dass meine Angaben zur Bewertung verarbeitet werden. (<a href="#" onclick="openLegal(\'privacy\');return false;" style="text-decoration:underline;">Datenschutz</a>)</label>
            </div>
            <div class="consent">
              <input type="checkbox" id="reviewPublishName" name="publishName" value="1" />
              <label for="reviewPublishName">Meinen Namen anzeigen (optional)</label>
            </div>
            <div class="subnote" id="reviewMsg" aria-live="polite" style="width:100%; text-align:right;"></div>
          </form>

          <iframe id="review_iframe" name="review_iframe" style="display:none;"></iframe>

          <div class="subnote">Hinweis: Bewertungen werden vor Anzeige kurz geprüft.</div>
        </div>
      </div>
    </div>
  </section>

  <section id="faq">
    <div class="wrap">
      <div class="container">
        <div class="section-title">
          <div><h2>FAQ</h2><p>Kurz & verständlich.</p></div>
        </div>
        
          <details>
            <summary>Warum wirkt Shuffle oft „schlecht“? <span class="chev" aria-hidden="true"></span></summary>
            <p>Ein Grund ist, dass viele Dienste Shuffle an dein Hörverhalten anpassen (z. B. „Smart Shuffle“ oder „Fewer Repeats“). Außerdem fühlt sich echte Zufälligkeit für Menschen oft „falsch“ an, weil Zufall auch Clustering erzeugt. Weiterlesen: <a href="https://support.spotify.com/de-en/article/shuffle-play/" target="_blank" rel="noopener">Spotify: Shuffle/Smart Shuffle</a>, <a href="https://newsroom.spotify.com/2023-03-08/smart-shuffle-new-life-spotify-playlists/" target="_blank" rel="noopener">Spotify: Smart Shuffle</a>.</p>
          </details>

          <details>
            <summary>Was macht true-shuffle anders? <span class="chev" aria-hidden="true"></span></summary>
            <p>true-shuffle erstellt eine echte Reihenfolge ohne Wiederholung: jeder Song genau einmal pro Durchlauf. Zusätzlich planen wir Optionen wie Prioritäten (z. B. Lieblingssongs früher) und personalisierte Shuffle-Profile.</p>
          </details>

          <details>
            <summary>Funktioniert das auch bei sehr großen Playlists? <span class="chev" aria-hidden="true"></span></summary>
            <p>Ja. Das Ziel ist, auch sehr große Playlists sauber zu laden (Paging) und komplett durchzuspielen – ohne Skip/Repeat.</p>
          </details>

          <details>
            <summary>Muss ich meinen Streamingdienst verlassen? <span class="chev" aria-hidden="true"></span></summary>
            <p>Nein. Du bleibst bei deinem Dienst. true-shuffle verbindet sich später per Login (App) und steuert Shuffle/Playback über die jeweilige API.</p>
          </details>

          <details>
            <summary>Was passiert mit meinen Daten? <span class="chev" aria-hidden="true"></span></summary>
            <p>Für die Warteliste speichern wir Name und E-Mail, um dich zu informieren. Bewertungen werden gespeichert und vor Anzeige kurz geprüft. Details stehen in der Datenschutzerklärung.</p>
          </details>

          <details>
            <summary>Kann ich Songs priorisieren oder überspringen? <span class="chev" aria-hidden="true"></span></summary>
            <p>Geplant: Du kannst Shuffle anpassen (Prioritäten, Stimmungen, „Heute bitte mehr davon“). Im Beta-Test sammeln wir Feedback, was am wichtigsten ist.</p>
          </details>
      </div>
    </div>
  </section>
</main>


<section id="contact" class="section">
  <div class="container">
    <div class="section-head">
      <h2>Kontakt</h2>
      <p>Fragen, Feedback oder Kooperation? Schreib uns.</p>
    </div>

    <div class="panel">
      <form class="form" id="contactForm" method="POST" target="contact_iframe" autocomplete="on">
        <input type="hidden" name="action" value="contact" />
        <input type="hidden" name="privacyVersion" value="2026-02-21" />
        <div style="position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden;" aria-hidden="true">
          <label>Website <input type="text" name="website" tabindex="-1" autocomplete="off" /></label>
        </div>

        <input class="input" type="text" id="contactName" name="name" placeholder="Name (optional)" />
        <input class="input" type="email" id="contactEmail" name="email" placeholder="E-Mail" required />
        <textarea class="input" id="contactMessage" name="message" placeholder="Nachricht…" maxlength="1200" style="flex:1 1 100%; min-height:120px;" required></textarea>

        <input type="hidden" name="source" value="website" />
        <input type="hidden" id="contactUA" name="userAgent" value="" />
        <input type="hidden" id="contactRef" name="referrer" value="" />
        <input type="hidden" id="contactLocale" name="locale" value="" />

        <button class="btn btn-primary" id="contactSubmit" type="submit">Nachricht senden</button>

        <div class="consent">
          <input type="checkbox" id="contactConsent" name="consent" value="1" required />
          <label for="contactConsent">Ich willige ein, dass meine Angaben zur Kontaktaufnahme verarbeitet werden. (<a href="#" onclick="openLegal('privacy');return false;" style="text-decoration:underline;">Datenschutz</a>)</label>
        </div>

        <div class="subnote" id="contactMsg" aria-live="polite" style="width:100%; text-align:right;"></div>
      </form>

      <iframe id="contact_iframe" name="contact_iframe" style="display:none;"></iframe>
    </div>
  </div>
</section>

<footer>
  <div class="wrap">
    <div class="container">
      <div class="foot">
        <div style="display:flex; align-items:center; gap:10px;">
          <img id="footerLogo" src="assets/logo_dark.png" alt="" style="width:20px; height:20px; border-radius:8px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.02);" />
          <span>© <span id="year"></span> true-shuffle.com</span>
        </div>
        <div style="display:flex; gap:4px; flex-wrap:wrap;">
          
            <a href="#top">Start</a>
            <a href="#impressions">Impressionen</a>
            <a href="#beta">Beta</a>
            <a href="#reviews">Bewertungen</a>
            <a href="#" onclick="openLegal('impressum');return false;">Impressum</a>
            <a href="#" onclick="openLegal('privacy');return false;">Datenschutz</a>
            <a href="#" onclick="openLegal('cookies');return false;">Cookies</a>
            <a href="#" id="cookieResetLink">Cookie-Hinweis zurücksetzen</a>
    
        </div>
      </div>
    </div>
  </div>
</footer>

<div class="modal" id="legalModal" role="dialog" aria-modal="true">
  <div class="modal-panel">
    <div class="modal-header">
      <b id="legalTitle">Info</b>
      <button class="btn" type="button" onclick="closeLegal()">Schließen</button>
    </div>
    <div class="modal-content">
      <div id="legalBody"></div>
    </div>
  </div>
</div>

<div id="cookieBanner" aria-live="polite">
  <div class="cookie-row">
    <div class="cookie-text">Wir verwenden kein Tracking. Wir speichern nur technisch notwendige Einstellungen (z. B. Theme) im Browser. Mehr dazu unter <a href="#" onclick="openLegal('cookies');return false;" style="text-decoration:underline;">Cookies</a>.</div>
    <div class="cookie-actions">
      <button class="btn" type="button" onclick="openLegal('cookies')">Details</button>
      <button class="btn btn-primary" type="button" id="cookieAcceptBtn">OK</button>
    </div>
  </div>
</div>

<script>
  const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbw6-_EHQDMmdCADWm2ig-ZcV8tFY4X-wNoTEp61mkALTNZIDUVHS3SaotLOqQqCfl_Z/exec";
  const PRIVACY_VERSION = "2026-02-21";
  const LOGO_DARK = "assets/logo_dark.png";
  const LOGO_LIGHT = "assets/logo_light.png";
  const HERO_MEDIA_DARK = "assets/brand_logo_loop.gif";
  const HERO_MEDIA_LIGHT = "assets/brand_logo_loop_light.gif";
const PRODUCT_IMAGES = ["assets/product_01_one-tap.PNG", "assets/product_02_features-card.PNG", "assets/product_03_comparison.PNG", "assets/product_04_10000-tracks.PNG"];

  const $ = (id) => document.getElementById(id);
  $("year").textContent = new Date().getFullYear();

  // actions
  $("betaForm").action = WEBAPP_URL;
  $("reviewForm").action = WEBAPP_URL;
  $("contactForm").action = WEBAPP_URL;

  // mobile menu
  const menuBtn = $("menuBtn");
  const drawer = $("drawer");
  menuBtn?.addEventListener("click", () => {
    const isOpen = drawer.classList.toggle("open");
    menuBtn.setAttribute("aria-expanded", String(isOpen));
  });

  // theme
  function applyTheme(mode){
    const isLight = mode === "light";
    document.body.classList.toggle("light", isLight);
    $("brandLogo").src = isLight ? LOGO_LIGHT : LOGO_DARK;
    $("footerLogo").src = isLight ? LOGO_LIGHT : LOGO_DARK;
    $("heroMedia").src = isLight ? HERO_MEDIA_LIGHT : HERO_MEDIA_DARK;
$("themeIcon").textContent = isLight ? "☀" : "☾";
    $("themeLabel").textContent = isLight ? "Dark" : "Light";
  }
  (function initTheme(){
    const saved = localStorage.getItem("true_shuffle_theme");
    if (saved === "light" || saved === "dark") return applyTheme(saved);
    const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
    applyTheme(prefersLight ? "light" : "dark");
  })();
  $("themeToggle").addEventListener("click", () => {
    const next = document.body.classList.contains("light") ? "dark" : "light";
    applyTheme(next);
    localStorage.setItem("true_shuffle_theme", next);
  });

  // cookie banner
  const cookieBanner = $("cookieBanner");
  $("cookieAcceptBtn").addEventListener("click", () => {
    localStorage.setItem("ts_cookie_ack_public", "1");
    cookieBanner.style.display = "none";
  });
  $("cookieResetLink").addEventListener("click", (e) => {
    e.preventDefault();
    localStorage.removeItem("ts_cookie_ack_public");
    cookieBanner.style.display = "block";
  });
  window.addEventListener("load", () => {
    if (localStorage.getItem("ts_cookie_ack_public") !== "1") cookieBanner.style.display = "block";
  });

  // slider
  const sliderTrack = $("sliderTrack");
  const sliderDots = $("sliderDots");
  const sliderNote = $("sliderNote");
  let sliderIndex = 0;

  function updateSlider(){
    sliderTrack.style.transform = `translateX(${-sliderIndex*100}%)`;
    [...sliderDots.children].forEach((d, i) => d.classList.toggle("active", i === sliderIndex));
  }
  function goToSlide(i){
    const n = PRODUCT_IMAGES.length || 1;
    sliderIndex = (i + n) % n;
    updateSlider();
  }
  function buildSlides(){
    sliderTrack.innerHTML = "";
    sliderDots.innerHTML = "";
    sliderNote.textContent = "";
    if (!PRODUCT_IMAGES.length) return;

    PRODUCT_IMAGES.forEach((src, i) => {
      const slide = document.createElement("div");
      slide.className = "slide";

      const media = document.createElement("div");
      media.className = "slide-media";
      media.style.setProperty("--bg", `url("${src}")`);

      const img = document.createElement("img");
      img.src = src;
      img.alt = "Impression " + (i+1);
      img.loading = "lazy";
      img.decoding = "async";
      img.onerror = () => {
        sliderNote.textContent = "Ein Bild wurde nicht gefunden. Prüfe Dateinamen im assets-Ordner.";
      };

      media.appendChild(img);
      slide.appendChild(media);
      sliderTrack.appendChild(slide);

      const dot = document.createElement("button");
      dot.className = "slider-dot" + (i === 0 ? " active" : "");
      dot.type = "button";
      dot.addEventListener("click", () => goToSlide(i));
      sliderDots.appendChild(dot);
    });
    sliderIndex = 0;
    updateSlider();
  }
  $("prevSlide").addEventListener("click", () => goToSlide(sliderIndex - 1));
  $("nextSlide").addEventListener("click", () => goToSlide(sliderIndex + 1));

  // swipe / drag
  let startX = null;
  sliderTrack.addEventListener("pointerdown", (e) => {
    startX = e.clientX;
    sliderTrack.setPointerCapture(e.pointerId);
  });
  sliderTrack.addEventListener("pointerup", (e) => {
    if (startX === null) return;
    const dx = e.clientX - startX;
    startX = null;
    if (Math.abs(dx) < 40) return;
    if (dx < 0) goToSlide(sliderIndex + 1);
    else goToSlide(sliderIndex - 1);
  });
  buildSlides();

  // forms feedback (uses postMessage from Apps Script response)
  const WEBAPP_ORIGIN = (function(){ try { return new URL(WEBAPP_URL).origin; } catch(e){ return ""; } })();

  const betaMsg = $("betaMsg");
  const betaSubmit = $("betaSubmit");
  let betaSubmitting = false;

    let betaAllowLateMessage = false;
const reviewMsg = $("reviewMsg");
  const reviewSubmit = $("reviewSubmit");
  let reviewSubmitting = false;

    let reviewAllowLateMessage = false;
const contactMsg = $("contactMsg");
  const contactSubmit = $("contactSubmit");
  let contactSubmitting = false;

    let contactAllowLateMessage = false;
let betaFallbackTimer = null;
  let reviewFallbackTimer = null;
  let contactFallbackTimer = null;

  function setMsg(el, text, isError){
    el.textContent = text || "";
    el.style.color = isError ? "var(--danger)" : "var(--muted)";
  }

  function betaHumanMessage(code){
    switch(code){
      case "pending": return "Danke! Bitte bestätige deine E-Mail über den Link in deinem Postfach.";
      case "pending_already": return "Bitte prüfe dein Postfach – die Bestätigungs-Mail wurde bereits gesendet.";
      case "already_confirmed": return "Du bist bereits bestätigt. Danke!";
      case "invalid_email": return "Bitte eine gültige E-Mail eingeben.";
      case "missing_email": return "Bitte E-Mail eingeben.";
      case "missing_consent": return "Bitte Einwilligung bestätigen.";
      case "rate_limited": return "Zu viele Versuche. Bitte später erneut probieren.";
      case "mail_failed": return "Mail konnte nicht versendet werden. Bitte später erneut oder andere Adresse verwenden.";
      default: return "Ups – da ist etwas schiefgelaufen. Bitte erneut versuchen.";
    }
  }

  function reviewHumanMessage(code){
    switch(code){
      case "ok": return "Danke! Bewertung ist eingegangen (erscheint nach Prüfung).";
      case "invalid_text": return "Bitte mindestens 5 Zeichen schreiben.";
      case "text_too_long": return "Bitte maximal 400 Zeichen.";
      case "missing_consent": return "Bitte Einwilligung bestätigen.";
      case "rate_limited": return "Zu viele Bewertungen in kurzer Zeit. Bitte später erneut.";
      default: return "Ups – da ist etwas schiefgelaufen. Bitte erneut versuchen.";
    }
  }


  function contactHumanMessage(code){
    switch(code){
      case "ok": return "Danke! Nachricht ist eingegangen.";
      case "invalid_email": return "Bitte eine gültige E-Mail eingeben.";
      case "missing_email": return "Bitte E-Mail eingeben.";
      case "invalid_message": return "Bitte eine Nachricht schreiben (mind. 10 Zeichen).";
      case "message_too_long": return "Bitte maximal 1200 Zeichen.";
      case "missing_consent": return "Bitte Einwilligung bestätigen.";
      case "rate_limited": return "Zu viele Nachrichten in kurzer Zeit. Bitte später erneut.";
      default: return "Ups – da ist etwas schiefgelaufen. Bitte erneut versuchen.";
    }
  }

  $("betaForm").addEventListener("submit", (e) => {
    $("betaUA").value = navigator.userAgent || "";
    $("betaRef").value = document.referrer || "";
    $("betaLocale").value = (navigator.language || "de").toLowerCase();

    if (!$("betaConsent").checked) {
      e.preventDefault();
      setMsg(betaMsg, betaHumanMessage("missing_consent"), true);
      return;
    }

    betaSubmitting = true;
    betaSubmit.disabled = true;
    setMsg(betaMsg, "Wird gesendet…", false);
    betaAllowLateMessage = true;

    if (betaFallbackTimer) clearTimeout(betaFallbackTimer);
    betaFallbackTimer = setTimeout(() => {
      if (betaSubmitting) {
        betaSubmitting = false;
        betaSubmit.disabled = false;
        
      betaAllowLateMessage = false;
betaAllowLateMessage = false;
        setMsg(betaMsg, "Keine Antwort vom Server. Bitte erneut versuchen.", true);
      }
    }, 12000);
});

  $("reviewForm").addEventListener("submit", (e) => {
    const txt = ($("reviewText").value || "").trim();
    if (txt.length < 5) {
      e.preventDefault();
      setMsg(reviewMsg, reviewHumanMessage("invalid_text"), true);
      return;
    }
    if (!$("reviewConsent").checked) {
      e.preventDefault();
      setMsg(reviewMsg, reviewHumanMessage("missing_consent"), true);
      return;
    }
    $("reviewUA").value = navigator.userAgent || "";
    reviewSubmitting = true;
    reviewSubmit.disabled = true;
    setMsg(reviewMsg, "Wird gesendet…", false);
    reviewAllowLateMessage = true;

    if (reviewFallbackTimer) clearTimeout(reviewFallbackTimer);
    reviewFallbackTimer = setTimeout(() => {
      if (reviewSubmitting) {
        reviewSubmitting = false;
        reviewSubmit.disabled = false;
        
      reviewAllowLateMessage = false;
reviewAllowLateMessage = false;
        // optimistic fallback: request likely saved even if postMessage is blocked
        setMsg(reviewMsg, reviewHumanMessage("ok"), false);
        document.getElementById("reviewName").value = "";
        document.getElementById("reviewRating").value = "5";
        document.getElementById("reviewText").value = "";
        document.getElementById("reviewConsent").checked = false;
        document.getElementById("reviewPublishName").checked = false;
        setTimeout(loadReviews, 700);
      }
    }, 12000);
});

  const TRUSTED_ORIGINS = new Set([WEBAPP_ORIGIN, "https://script.googleusercontent.com"]); 

  // Fallback: Apps Script responses can be blocked inside iframes in some browsers.
  // In that case postMessage never arrives, but the POST still succeeds. Mark success on iframe load.
  document.getElementById("beta_iframe").addEventListener("load", () => {
    if (!betaSubmitting) return;
    if (betaFallbackTimer) { clearTimeout(betaFallbackTimer); betaFallbackTimer = null; }
    betaSubmitting = false;
    betaSubmit.disabled = false;
    
      betaAllowLateMessage = false;
// iframe fallback can fire before postMessage. Allow late postMessage to override this message.
    betaAllowLateMessage = true;
    setMsg(betaMsg, betaHumanMessage("pending"), false);
    document.getElementById("betaName").value = "";
    document.getElementById("betaEmail").value = "";
    document.getElementById("betaConsent").checked = false;
    setTimeout(() => { betaAllowLateMessage = false; }, 4000);
  });
  document.getElementById("review_iframe").addEventListener("load", () => {
    if (!reviewSubmitting) return;
    if (reviewFallbackTimer) { clearTimeout(reviewFallbackTimer); reviewFallbackTimer = null; }
    reviewSubmitting = false;
    reviewSubmit.disabled = false;
    
      reviewAllowLateMessage = false;
reviewAllowLateMessage = true;
    setMsg(reviewMsg, reviewHumanMessage("ok"), false);
    document.getElementById("reviewName").value = "";
    document.getElementById("reviewRating").value = "5";
    document.getElementById("reviewText").value = "";
    document.getElementById("reviewConsent").checked = false;
    document.getElementById("reviewPublishName").checked = false;
    setTimeout(loadReviews, 700);
    setTimeout(() => { reviewAllowLateMessage = false; }, 4000);
  });
  document.getElementById("contact_iframe").addEventListener("load", () => {
    if (!contactSubmitting) return;
    if (contactFallbackTimer) { clearTimeout(contactFallbackTimer); contactFallbackTimer = null; }
    contactSubmitting = false;
    contactSubmit.disabled = false;
    
      contactAllowLateMessage = false;
contactAllowLateMessage = true;
    setMsg(contactMsg, contactHumanMessage("ok"), false);
    document.getElementById("contactName").value = "";
    document.getElementById("contactEmail").value = "";
    document.getElementById("contactMessage").value = "";
    document.getElementById("contactConsent").checked = false;
    setTimeout(() => { contactAllowLateMessage = false; }, 4000);
  });


  
  $("contactForm").addEventListener("submit", (e) => {
    $("contactUA").value = navigator.userAgent || "";
    $("contactRef").value = document.referrer || "";
    $("contactLocale").value = (navigator.language || "de").slice(0, 10);

    if (contactSubmitting) { e.preventDefault(); return; }
    contactSubmitting = true;
    contactAllowLateMessage = true;
    contactSubmit.disabled = true;
    setMsg(contactMsg, "Wird gesendet…", false);

    if (contactFallbackTimer) clearTimeout(contactFallbackTimer);
    contactFallbackTimer = setTimeout(() => {
      if (contactSubmitting) {
        contactSubmitting = false;
        contactSubmit.disabled = false;
        
      contactAllowLateMessage = false;
contactAllowLateMessage = false;
        setMsg(contactMsg, "Keine Antwort vom Server. Bitte erneut versuchen.", true);
      }
    }, 12000);
  });

window.addEventListener("message", (ev) => {
    if (WEBAPP_ORIGIN && !TRUSTED_ORIGINS.has(ev.origin)) return;
    const d = ev.data || {};
    if (!d || d.ts !== true) return;

    if (d.action === "beta" && (betaSubmitting || betaAllowLateMessage)) {
      if (betaFallbackTimer) { clearTimeout(betaFallbackTimer); betaFallbackTimer = null; }
      betaSubmitting = false;
      betaSubmit.disabled = false;

      
      betaAllowLateMessage = false;
const ok = !!d.ok;
      setMsg(betaMsg, betaHumanMessage(String(d.code || "")), !ok);

      if (ok) {
        $("betaName").value = "";
        $("betaEmail").value = "";
        $("betaConsent").checked = false;
      }
    }

    if (d.action === "review" && (reviewSubmitting || reviewAllowLateMessage)) {
      if (reviewFallbackTimer) { clearTimeout(reviewFallbackTimer); reviewFallbackTimer = null; }
      reviewSubmitting = false;
      reviewSubmit.disabled = false;

      
      reviewAllowLateMessage = false;
const ok = !!d.ok;
      setMsg(reviewMsg, reviewHumanMessage(String(d.code || "")), !ok);

      if (ok) {
        $("reviewName").value = "";
        $("reviewRating").value = "5";
        $("reviewText").value = "";
        $("reviewConsent").checked = false;
        $("reviewPublishName").checked = false;
        setTimeout(loadReviews, 700);
      }
    }

    if (d.action === "contact" && (contactSubmitting || contactAllowLateMessage)) {
      if (contactFallbackTimer) { clearTimeout(contactFallbackTimer); contactFallbackTimer = null; }
      contactSubmitting = false;
      contactSubmit.disabled = false;

      
      contactAllowLateMessage = false;
const ok = !!d.ok;
      setMsg(contactMsg, contactHumanMessage(String(d.code || "")), !ok);

      if (ok) {
        $("contactName").value = "";
        $("contactEmail").value = "";
        $("contactMessage").value = "";
        $("contactConsent").checked = false;
      }
    }

  });

  // reviews JSONP
  const reviewsList = $("reviewsList");
  const ratingBadge = $("ratingBadge");
  const reviewsStatus = $("reviewsStatus");

  function stars(n){
    n = Math.max(1, Math.min(5, Number(n || 5)));
    return "★★★★★".slice(0,n) + "☆☆☆☆☆".slice(0, 5-n);
  }

  function escapeHTML(s){
    return String(s)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/\"/g, "&quot;")
      .replace(/'/g, "&#39;");
  }

  function renderReviews(items){
    reviewsList.innerHTML = "";
    if (!items.length) {
      reviewsList.innerHTML = `
        <div class="review">
          <div class="name">Noch keine Bewertungen</div>
          <div class="stars">☆☆☆☆☆</div>
          <div class="text">Sei die erste Person, die eine Bewertung schreibt.</div>
          <div class="meta">Bewertungen erscheinen nach kurzer Prüfung.</div>
        </div>
      `;
      ratingBadge.innerHTML = `<span class="dot"></span><span>⭐ 0.0 / 5 (0)</span>`;
      return;
    }
    const avg = items.reduce((a,b)=>a+(Number(b.rating)||0),0) / items.length;
    ratingBadge.innerHTML = `<span class="dot"></span><span>⭐ ${avg.toFixed(1)} / 5 (${items.length})</span>`;
    items.slice().reverse().forEach(r => {
      const dt = r.timestamp ? new Date(r.timestamp) : new Date();
            const name = (r.name && String(r.name).trim()) ? String(r.name).trim() : "Anonym";
      const safeName = escapeHTML(name);
      const safeText = escapeHTML(String(r.text || ""));
      const el = document.createElement("div");
      el.className = "review";
      el.innerHTML = `
        <div class="name">${safeName}</div>
        <div class="stars">${stars(r.rating)}</div>
        <div class="text">${safeText}</div>
        <div class="meta">${isNaN(dt.getTime()) ? "" : dt.toLocaleDateString("de-DE")}</div>
      `;
      reviewsList.appendChild(el);
    });
  }

  window.tsReviewsCb = function(payload){
    reviewsStatus.textContent = "";
    const items = Array.isArray(payload?.reviews) ? payload.reviews : [];
    renderReviews(items);
    window.__reviewsLoaded = true;
  };

  function loadReviews(){
    window.__reviewsLoaded = false;
    reviewsStatus.textContent = "Bewertungen werden geladen…";

    setTimeout(() => {
      if (!window.__reviewsLoaded) reviewsStatus.textContent = "Bewertungen konnten nicht geladen werden. Prüfe Web-App Zugriff („Anyone“) und den Link.";
    }, 2500);

    const s = document.createElement("script");
    s.src = `${WEBAPP_URL}?action=reviews&callback=tsReviewsCb&lang=de&t=${Date.now()}`;
    s.async = true;
    s.onerror = () => {
      reviewsStatus.textContent = "Fehler beim Laden der Bewertungen.";
      renderReviews([]);
    };
    document.body.appendChild(s);
    setTimeout(() => { try { s.remove(); } catch {} }, 8000);
  }
  loadReviews();

  // legal modal
  const legalModal = $("legalModal");
  const legalTitle = $("legalTitle");
  const legalBody = $("legalBody");

  function openLegal(type){
    legalModal.style.display = "block";
    document.body.style.overflow = "hidden";

    if (type === "impressum") {
      legalTitle.textContent = "Impressum";
      legalBody.innerHTML = `        <p><b>Angaben gemäß § 5 DDG</b></p>
        <p><b>true-shuffle GmbH</b><br/>
        Am Schwarzen Steg 5a<br/>
        95448 Bayreuth<br/>
        Deutschland</p>

        <p><b>Kontakt</b><br/>
        Telefon: +49 176 6447 2296<br/>
        E-Mail: hello@true-shuffle.com<br/>
        Kontaktformular: siehe Abschnitt „Kontakt“</p>

        <p><b>Register</b><br/>
        Handelsregister: wird nachgereicht<br/>
        USt-IdNr.: wird nachgereicht</p>

        <p><b>Verantwortlich nach § 18 Abs. 2 MStV</b><br/>
        true-shuffle GmbH<br/>
        Am Schwarzen Steg 5a, 95448 Bayreuth</p>`;
      return;
    }

    if (type === "cookies") {
      legalTitle.textContent = "Cookies &amp; lokale Speicherung";
      legalBody.innerHTML = `
        <p>Wir verwenden <b>kein Tracking</b> und setzen keine Marketing-/Analyse-Cookies ein.</p>
        <p><b>Technisch notwendige Speicherung</b><br/>
        Für Komfortfunktionen speichern wir wenige Einstellungen lokal im Browser (localStorage), z. B. deine Theme-Auswahl und ob du den Cookie-Hinweis bereits gesehen hast.</p>
        <p>Du kannst diese Speicherung über den Link „Cookie-Hinweis zurücksetzen“ im Footer löschen und den Hinweis erneut anzeigen lassen.</p>`;
      return;
    }

    // privacy
    legalTitle.textContent = "Datenschutz";
    legalBody.innerHTML = `      <p><b>1. Verantwortliche</b><br/>
      true-shuffle GmbH<br/>
      Am Schwarzen Steg 5a, 95448 Bayreuth, Deutschland<br/>
      Telefon: +49 176 6447 2296<br/>
      E-Mail: hello@true-shuffle.com</p>

      <p><b>2. Zwecke &amp; Rechtsgrundlagen</b></p>
      <ul>
        <li><b>Beta-Warteliste (Double-Opt-In):</b> Verarbeitung von Name (optional) und E-Mail zur Verwaltung der Warteliste, Versand einer Bestätigungs-E-Mail und Bestätigung deiner Anmeldung. Optional: Streamingdienst &amp; Playlistgröße (nur für Produktplanung/Priorisierung). <i>Rechtsgrundlage:</i> Einwilligung (Art. 6 Abs. 1 lit. a DSGVO).</li>
        <li><b>Bewertungen:</b> Verarbeitung von Bewertungs-Text, Sternebewertung und ggf. Name (nur wenn „Name anzeigen“ aktiviert). Bewertungen erscheinen erst nach Prüfung. <i>Rechtsgrundlage:</i> Einwilligung (Art. 6 Abs. 1 lit. a DSGVO).</li>
        <li><b>Kontaktformular:</b> Bearbeitung deiner Anfrage (Name optional, E-Mail, Nachricht). <i>Rechtsgrundlage:</i> Art. 6 Abs. 1 lit. b DSGVO (vorvertragliche Kommunikation) bzw. lit. f DSGVO (berechtigtes Interesse an der Beantwortung).</li>
        <li><b>Hosting/Logs:</b> Technische Bereitstellung, Stabilität und Sicherheit der Website. <i>Rechtsgrundlage:</i> Art. 6 Abs. 1 lit. f DSGVO.</li>
      </ul>

      <p><b>3. Hosting &amp; Empfänger</b><br/>
      Diese Website wird über GitHub Pages bereitgestellt. Für Formulare nutzen wir Google Apps Script &amp; Google Sheets (Speicherung der Formulardaten) sowie Google-Dienste zum Versand der Bestätigungs-E-Mail.</p>

      <p><b>4. Speicherdauer</b></p>
      <ul>
        <li><b>Waitlist:</b> bis Launch + 6 Monate, danach Löschung/Anonymisierung, sofern keine weitere Einwilligung vorliegt.</li>
        <li><b>Bewertungen:</b> bis Löschanfrage oder solange die Bewertung angezeigt werden soll.</li>
        <li><b>Kontaktanfragen:</b> bis Abschluss der Anfrage; i. d. R. max. 12 Monate.</li>
      </ul>

      <p><b>5. Veröffentlichung von Namen bei Bewertungen</b><br/>
      Dein Name wird nur angezeigt, wenn du die Option „Meinen Namen anzeigen“ aktivierst. Ohne diese Option wird „Anonym“ angezeigt.</p>

      <p><b>6. Automatische Übersetzung von Bewertungen</b><br/>
      Zur Anzeige können Bewertungen abhängig von der Seitensprache automatisch ins Deutsche oder Englische übersetzt werden (Google Language/Translate in Apps Script). Originaltexte werden weiterhin gespeichert.</p>

      <p><b>7. Deine Rechte</b><br/>
      Du hast das Recht auf Auskunft, Berichtigung, Löschung, Einschränkung, Datenübertragbarkeit sowie Widerspruch. Erteilte Einwilligungen kannst du jederzeit mit Wirkung für die Zukunft widerrufen. Außerdem besteht ein Beschwerderecht bei einer Datenschutzaufsichtsbehörde.</p>

      <p><b>8. Kontakt zum Datenschutz</b><br/>
      Für Datenschutzanfragen: hello@true-shuffle.com</p>`;
  }
  function closeLegal(){
    legalModal.style.display = "none";
    document.body.style.overflow = "";
  }
  window.openLegal = openLegal;
  window.closeLegal = closeLegal;
  legalModal.addEventListener("click", (e) => { if (e.target === legalModal) closeLegal(); });
</script>
</body>
</html>
